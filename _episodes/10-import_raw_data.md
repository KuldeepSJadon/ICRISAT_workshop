---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 10-import_raw_data.md in _episodes_rmd/
title: "Importing Raw Ascochyta Blight Lesion Count Data"
teaching: 20
exercises: 0
questions:
- "How can I prepare my data for analysis and save it without overwriting the raw data?"
objectives:
- " Understand how to import real-world data"
- " Calculate mean values from raw data"
- " Data frame manipulation including dropping and converting columns"
- " Save the newly formatted data for use in further work using R"
keypoints:
- "Use `readr` to import CSV files in place of `read.csv()`"
- "Use `dplyr` to add new columns of data."
- "Use `dplyr` to summarise data."
- "Create a data set that is useful for visualisation and modelling."
- "Using RMarkdown can help you ensure reproducible research that can be reshared and reused."
source: Rmd
---



To get started with the Ascochyta blight (AB) modelling, we need to import the lesion count data and calculate mean lesion values for each respective station along the ten transects.

In the first step, the data is imported directly from the Zenodo archive.

## Load libraries

We will use the `tidyverse` to import and format these data for use in our model.


~~~
library("tidyverse")
~~~
{: .language-r}



~~~
── Attaching packages ─────────────────────────── tidyverse 1.3.0 ──
~~~
{: .output}



~~~
✓ ggplot2 3.3.2     ✓ purrr   0.3.4
✓ tibble  3.0.3     ✓ dplyr   1.0.2
✓ tidyr   1.1.1     ✓ stringr 1.4.0
✓ readr   1.3.1     ✓ forcats 0.5.0
~~~
{: .output}



~~~
── Conflicts ────────────────────────────── tidyverse_conflicts() ──
x dplyr::filter() masks stats::filter()
x dplyr::lag()    masks stats::lag()
~~~
{: .output}

## Import and Inspect Lesion Data

Using `read_csv()` import the lesion count data from Zenodo where they are archived.
See [10.5281/zenodo.3842293](https://doi.org/10.5281/zenodo.3842293) for a full description of the data.
The data have already been well formatted for importing into R but we still need to make some changes.


~~~
lesion_counts <-
   read_csv("https://zenodo.org/record/3842293/files/lesion_counts.csv?download=1")
head(lesion_counts)
~~~
{: .language-r}



~~~
# A tibble: 6 x 13
  site    rep distance station transect dist_stat plant_no pot_no counts_p1
  <chr> <dbl> <chr>      <dbl>    <dbl> <chr>        <dbl>  <dbl>     <dbl>
1 pbc       1 0 m            1        1 0m_1             5      1         1
2 pbc       1 0 m            1        1 0m_1             5      2         2
3 pbc       1 0 m            2        4 0m_2             5      3         3
4 pbc       1 0 m            2        4 0m_2             5      4         5
5 pbc       1 0 m            3        7 0m_3             5      5         3
6 pbc       1 0 m            3        7 0m_3             5      6         0
# … with 4 more variables: counts_p2 <dbl>, counts_p3 <dbl>, counts_p4 <dbl>,
#   counts_p5 <dbl>
~~~
{: .output}

In the next step, the "m" from the `distance` column is dropped and the column is converted to numeric.
A new column, `SpEv` (Spread Event), is created for each location and replicated event at that location. Another new column, `degrees`, is added for each transect to indicate the direction in degrees based on J. Fanning's best information.
Lastly the mean lesions counted per plant within the pot, `m_lesions` is calculated for each of the transects at each distance, 0, 10, 25, 50 and 75 meters from the plots.

After the data are updated, a column for precipitation type, `ptype`, is added and the spread events, `SpEv`, are renamed for clarity and ordered as factors for data visualisation.

There's a lot going on here, so we'll go through it slowly and line by line.



~~~
lesion_counts <-
   lesion_counts %>%
   mutate(site = str_remove(site, " SPA")) %>%
   mutate(distance = as.numeric(str_replace(distance, " m", ""))) %>%
   unite(SpEv, c(site, rep), remove = FALSE) %>%
   mutate(
      degrees = case_when(
         site == "Curyo" & transect == 1 ~ 290,
         site == "Curyo" & transect == 2 ~ 300,
         site == "Curyo" & transect == 3 ~ 310,
         site == "Curyo" & transect == 4 ~ 320,
         site == "Curyo" & transect == 5 ~ 330,
         site == "Curyo" & transect == 6 ~ 340,
         site == "Curyo" & transect == 7 ~ 350,
         site == "Curyo" & transect == 8 ~ 360,
         site == "Curyo" & transect == 9 ~ 10,
         site == "Curyo" & transect == 10 ~ 20,
         site == "Horsham" & transect == 1 ~ 45,
         site == "Horsham" & transect == 2 ~ 55,
         site == "Horsham" & transect == 3 ~ 65,
         site == "Horsham" & transect == 4 ~ 75,
         site == "Horsham" & transect == 5 ~ 85,
         site == "Horsham" & transect == 6 ~ 95,
         site == "Horsham" & transect == 7 ~ 105,
         site == "Horsham" & transect == 8 ~ 115,
         site == "Horsham" & transect == 9 ~ 125,
         site == "Horsham" & transect == 10 ~ 135,
         site == "pbc" & transect == 1 ~ 45,
         site == "pbc" & transect == 2 ~ 55,
         site == "pbc" & transect == 3 ~ 65,
         site == "pbc" & transect == 4 ~ 75,
         site == "pbc" & transect == 5 ~ 85,
         site == "pbc" & transect == 6 ~ 95,
         site == "pbc" & transect == 7 ~ 105,
         site == "pbc" & transect == 8 ~ 115,
         site == "pbc" & transect == 9 ~ 125,
         site == "pbc" & transect == 10 ~ 135
      )
   ) %>%
   mutate(
      ptype = case_when(
         SpEv == "pbc_1" ~ "irrigation",
         SpEv == "pbc_2" ~ "irrigation",
         SpEv == "pbc_3" ~ "mixed",
         SpEv == "Horsham_1" ~ "rainfall",
         SpEv == "Horsham_2" ~ "rainfall",
         SpEv == "Curyo_1" ~ "rainfall"
      )
   ) %>%
   mutate(
      site = case_when(
         site == "pbc" ~ "Horsham irrigated",
         site == "Horsham" ~ "Horsham dryland",
         site == "Curyo" ~ "Curyo"
      )
   ) %>%
   mutate(
      SpEv = case_when(
         SpEv == "pbc_1" ~ "Horsham Irrg 1",
         SpEv == "pbc_2" ~ "Horsham Irrg 2",
         SpEv == "pbc_3" ~ "Horsham Mixd 1",
         SpEv == "Horsham_1" ~ "Horsham Rain 1",
         SpEv == "Horsham_2" ~ "Horsham Rain 2",
         SpEv == "Curyo_1" ~ "Curyo Rain 1"
      )
   ) %>%
   mutate_at(vars(SpEv, site, rep), factor) %>%
   mutate(m_lesions = rowMeans(select(., counts_p1:counts_p5),
                               na.rm = TRUE)) %>%
   select(-dist_stat) %>%
   arrange(SpEv, transect, distance)
~~~
{: .language-r}

Use `glimpse()` from `dplyr` to inspect the data.


~~~
glimpse(lesion_counts)
~~~
{: .language-r}



~~~
Rows: 336
Columns: 16
$ SpEv      <fct> Curyo Rain 1, Curyo Rain 1, Curyo Rain 1, Curyo Rain 1, Cur…
$ site      <fct> Curyo, Curyo, Curyo, Curyo, Curyo, Curyo, Curyo, Curyo, Cur…
$ rep       <fct> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ distance  <dbl> 0, 0, 10, 10, 25, 25, 50, 75, 25, 25, 50, 75, 25, 25, 50, 7…
$ station   <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2,…
$ transect  <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4,…
$ plant_no  <dbl> 5, 5, 5, 5, 5, 5, 3, 3, 5, 5, 3, 3, 5, 5, 3, 3, 5, 5, 5, 5,…
$ pot_no    <dbl> 1, 2, 9, 10, 17, 18, 37, 47, 19, 20, 38, 48, 21, 22, 39, 49…
$ counts_p1 <dbl> 2, 3, 0, 2, 2, 2, 0, 0, 1, 1, 0, 1, 2, 0, 1, 0, 0, 3, 0, 0,…
$ counts_p2 <dbl> 0, 0, 3, 0, 0, 1, 4, 1, 2, 0, 0, 0, 2, 1, 0, 0, 2, 3, 0, 0,…
$ counts_p3 <dbl> 4, 0, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 1, 3, 0, 0, 0,…
$ counts_p4 <dbl> 2, 2, 1, 2, 0, 2, NA, NA, 2, 0, NA, NA, 3, 0, NA, NA, 1, 5,…
$ counts_p5 <dbl> 2, 3, 1, 4, 0, 0, NA, NA, 2, 1, NA, NA, NA, NA, NA, NA, 2, …
$ degrees   <dbl> 290, 290, 290, 290, 290, 290, 290, 290, 300, 300, 300, 300,…
$ ptype     <chr> "rainfall", "rainfall", "rainfall", "rainfall", "rainfall",…
$ m_lesions <dbl> 2.0000, 1.6000, 1.0000, 1.6000, 0.6000, 1.0000, 1.6667, 0.6…
~~~
{: .output}
