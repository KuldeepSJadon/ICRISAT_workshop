---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 08-import_weather_data.md in _episodes_rmd/
title: "Importing Weather Data for Use in Modelling Spore Dispersal"
teaching: 15
exercises: 10
questions:
- "How can I prepare my weather data from diferent stations and merge it?"
- "How can I prepare my weather data for use in an analysis?"
- "How can I save my weather data it without overwriting the raw data?"
objectives:
- "Understand how to import real-world data"
- "Understand how to merge different data sets"
- "Calculate mean values from raw data for wind direction"
- "Data frame manipulation including dropping and converting columns"
- "Summarise weather data from a fine temporal resolution to a coarser resolution"
- "Save the newly formatted data for use in further work using R"
keypoints:
- "Use `readr` to import CSV files in place of `read.csv()`"
- "Use `dplyr` to add new columns of data."
- "Use `dplyr` to summarise data."
- "Create a data set that is useful for visualisation and modelling."
- "Wind direction is not linear, it is circular and requires special handling to average."
source: Rmd
---



### Load Libraries for This Exercise

Load libraries that will be used for this exercise.


~~~
library("ChickpeaAscoDispersal")
library("tidyverse")
library("lubridate")
library("skimr")
library("kableExtra")
library("scales")

theme_set(theme_bw(base_size = 14))
~~~
{: .language-r}

### Weather data

Import and select only the weather data necessary for analysis from Curyo and Horsham weather stations.
Dates for events are recorded in the "Dispersal experiments dates.csv" file and are used to subset the weather data in the weather data file.

### Irrigation Amount Data

Dr J. Fanning (AgVic) tested the irrigation system on two separate days, 2020-03-17 and 2020-03-18.
Following is his e-mail and conclusions.

> This is based on the following
I have checked the irrigation schedules and I irrigated for 90 minutes each time for these experiments. When I irrigated it was usually below 10kph.

> The team have run the test once yesterday morning and once this morning.
It is difficult, as the wind has not been dropping down to 0-5kph and there is no wind breaks out there. Based on the forecast this will be the best we can get for at least the length of the forecast ahead.

> First test showed 0.12mm per min, with 08-15kph wind

> Second test showed 0.13mm per min with 08-20kph wind

> Even with the variability I am confident in these figures as the wind is mainly changing where is being irrigated rather than the amount based on the testing.
Less irrigation into the wind. We have a Northerly wind currently where as it was westerly when we irrigated so wind would have been blowing with the length of the sprinkler system so to speak.
With the piping running East/West.
The attached picture is orientated with North to the top of the page so shows the length running east/west which I feels reduces the variability in irrigation.

Based on this, we elected to use 11&nbsp;mm as the amount of irrigation applied during the spread events at Horsham.

These values are added to the data in the [Summarise weather data by event](Summarise weather data by event) code chunk for the raw weather output.

## Curyo Weather Data

In this first step, the data are imported and only the date and time, average wind speed and average wind direction are selected.
The data are once again downloaded from the Zenodo archive, [10.5281/zenodo.3842293](https://doi.org/10.5281/zenodo.3842293).

### Import Curyo Weather Data


~~~
Curyo_w <-
   read_csv("https://zenodo.org/record/3842293/files/Curyo_SPA_2019_weather.csv?download=1")
head(Curyo_w)
~~~
{: .language-r}



~~~
# A tibble: 6 x 17
  Time  `Air Temperatur… `Soil Temperatu… `Relative Humid… `Wind Speed - m…
  <chr>            <dbl>            <dbl>            <dbl>            <dbl>
1 22/0…             28.5             26.1             56.3                0
2 22/0…             28.3             27.4             56.6                0
3 22/0…             28.4             27.4             57                  0
4 22/0…             28.4             27.5             56.9                0
5 22/0…             28.3             27.5             56.4                0
6 22/0…             28.4             27.6             55.7                0
# … with 12 more variables: `Wind Speed - average (km/h)` <dbl>, `Wind Speed -
#   maximum (km/h)` <dbl>, `Wind Direction - average (º)` <dbl>, `Solar
#   Radiation - average (W/m^2)` <dbl>, `Sigma - average (deg)` <dbl>,
#   `Rainfall - (mm)` <dbl>, `Voltage - minimum (V)` <dbl>, `Voltage - average
#   (V)` <dbl>, `Voltage - maximum (V)` <dbl>, `Apparent Temperature - average
#   (ºC)` <dbl>, `Dew Point - average (ºC)` <dbl>, `Delta T - average
#   (ºC)` <dbl>
~~~
{: .output}

Select only the columns we need, convert dates to a date class, add the location, "Curyo" and make it the first column in the data frame.


~~~
   select(Time,
          'Wind Speed - average (km/h)',
          'Wind Direction - average (º)',
          "Rainfall - (mm)") %>%
   mutate(Time = dmy_hm(Time)) %>%
   mutate(Location = "Curyo") %>%
   select(Location, everything())
~~~
{: .language-r}



~~~
Error in select(Time, "Wind Speed - average (km/h)", "Wind Direction - average (º)", : object 'Time' not found
~~~
{: .error}

### Inspect the Curyo Weather Data


~~~
skim(Curyo_w)
~~~
{: .language-r}


<table style='width: auto;'
        class='table table-condensed'>
<caption>Data summary</caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;">   </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Name </td>
   <td style="text-align:left;"> Curyo_w </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of rows </td>
   <td style="text-align:left;"> 43473 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of columns </td>
   <td style="text-align:left;"> 17 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> _______________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Column type frequency: </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> character </td>
   <td style="text-align:left;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> numeric </td>
   <td style="text-align:left;"> 16 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ________________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Group variables </td>
   <td style="text-align:left;"> None </td>
  </tr>
</tbody>
</table>


**Variable type: character**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> min </th>
   <th style="text-align:right;"> max </th>
   <th style="text-align:right;"> empty </th>
   <th style="text-align:right;"> n_unique </th>
   <th style="text-align:right;"> whitespace </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Time </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 16 </td>
   <td style="text-align:right;"> 16 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 43473 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table>


**Variable type: numeric**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> mean </th>
   <th style="text-align:right;"> sd </th>
   <th style="text-align:right;"> p0 </th>
   <th style="text-align:right;"> p25 </th>
   <th style="text-align:right;"> p50 </th>
   <th style="text-align:right;"> p75 </th>
   <th style="text-align:right;"> p100 </th>
   <th style="text-align:left;"> hist </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Air Temperature - average (ºC) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 14.16 </td>
   <td style="text-align:right;"> 7.39 </td>
   <td style="text-align:right;"> -0.90 </td>
   <td style="text-align:right;"> 8.80 </td>
   <td style="text-align:right;"> 12.90 </td>
   <td style="text-align:right;"> 18.50 </td>
   <td style="text-align:right;"> 41.30 </td>
   <td style="text-align:left;"> ▃▇▅▂▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Soil Temperature - average (ºC) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 16.81 </td>
   <td style="text-align:right;"> 5.96 </td>
   <td style="text-align:right;"> 5.50 </td>
   <td style="text-align:right;"> 11.70 </td>
   <td style="text-align:right;"> 16.50 </td>
   <td style="text-align:right;"> 21.10 </td>
   <td style="text-align:right;"> 41.80 </td>
   <td style="text-align:left;"> ▇▇▆▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Relative Humidity - average (%) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 66.13 </td>
   <td style="text-align:right;"> 26.50 </td>
   <td style="text-align:right;"> 4.00 </td>
   <td style="text-align:right;"> 44.00 </td>
   <td style="text-align:right;"> 70.40 </td>
   <td style="text-align:right;"> 90.30 </td>
   <td style="text-align:right;"> 99.90 </td>
   <td style="text-align:left;"> ▂▃▃▅▇ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Wind Speed - minimum (km/h) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 4.69 </td>
   <td style="text-align:right;"> 4.80 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 3.74 </td>
   <td style="text-align:right;"> 6.95 </td>
   <td style="text-align:right;"> 33.84 </td>
   <td style="text-align:left;"> ▇▂▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Wind Speed - average (km/h) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 9.33 </td>
   <td style="text-align:right;"> 7.46 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 3.85 </td>
   <td style="text-align:right;"> 7.78 </td>
   <td style="text-align:right;"> 13.46 </td>
   <td style="text-align:right;"> 55.30 </td>
   <td style="text-align:left;"> ▇▃▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Wind Speed - maximum (km/h) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 15.57 </td>
   <td style="text-align:right;"> 11.29 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 6.95 </td>
   <td style="text-align:right;"> 13.43 </td>
   <td style="text-align:right;"> 22.00 </td>
   <td style="text-align:right;"> 427.10 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Wind Direction - average (º) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 165.15 </td>
   <td style="text-align:right;"> 142.04 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 7.85 </td>
   <td style="text-align:right;"> 158.55 </td>
   <td style="text-align:right;"> 307.60 </td>
   <td style="text-align:right;"> 359.89 </td>
   <td style="text-align:left;"> ▇▁▁▃▆ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Solar Radiation - average (W/m^2) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 195.72 </td>
   <td style="text-align:right;"> 298.32 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 327.00 </td>
   <td style="text-align:right;"> 1301.00 </td>
   <td style="text-align:left;"> ▇▂▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sigma - average (deg) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 28.67 </td>
   <td style="text-align:right;"> 24.48 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 6.19 </td>
   <td style="text-align:right;"> 22.77 </td>
   <td style="text-align:right;"> 45.44 </td>
   <td style="text-align:right;"> 102.76 </td>
   <td style="text-align:left;"> ▇▅▃▂▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Rainfall - (mm) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.07 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 3.80 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Voltage - minimum (V) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 13.30 </td>
   <td style="text-align:right;"> 0.47 </td>
   <td style="text-align:right;"> 12.53 </td>
   <td style="text-align:right;"> 12.91 </td>
   <td style="text-align:right;"> 13.02 </td>
   <td style="text-align:right;"> 13.81 </td>
   <td style="text-align:right;"> 14.33 </td>
   <td style="text-align:left;"> ▃▇▁▅▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Voltage - average (V) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 13.35 </td>
   <td style="text-align:right;"> 0.46 </td>
   <td style="text-align:right;"> 12.61 </td>
   <td style="text-align:right;"> 12.96 </td>
   <td style="text-align:right;"> 13.07 </td>
   <td style="text-align:right;"> 13.86 </td>
   <td style="text-align:right;"> 14.34 </td>
   <td style="text-align:left;"> ▅▇▁▆▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Voltage - maximum (V) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 13.38 </td>
   <td style="text-align:right;"> 0.47 </td>
   <td style="text-align:right;"> 12.69 </td>
   <td style="text-align:right;"> 12.99 </td>
   <td style="text-align:right;"> 13.08 </td>
   <td style="text-align:right;"> 13.89 </td>
   <td style="text-align:right;"> 14.90 </td>
   <td style="text-align:left;"> ▇▁▅▂▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apparent Temperature - average (ºC) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 11.55 </td>
   <td style="text-align:right;"> 7.44 </td>
   <td style="text-align:right;"> -4.00 </td>
   <td style="text-align:right;"> 6.26 </td>
   <td style="text-align:right;"> 10.29 </td>
   <td style="text-align:right;"> 16.03 </td>
   <td style="text-align:right;"> 40.77 </td>
   <td style="text-align:left;"> ▃▇▃▂▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dew Point - average (ºC) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 6.09 </td>
   <td style="text-align:right;"> 3.98 </td>
   <td style="text-align:right;"> -12.80 </td>
   <td style="text-align:right;"> 3.73 </td>
   <td style="text-align:right;"> 6.15 </td>
   <td style="text-align:right;"> 8.63 </td>
   <td style="text-align:right;"> 20.88 </td>
   <td style="text-align:left;"> ▁▁▇▅▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Delta T - average (ºC) </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 4.47 </td>
   <td style="text-align:right;"> 4.35 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 1.03 </td>
   <td style="text-align:right;"> 3.16 </td>
   <td style="text-align:right;"> 6.77 </td>
   <td style="text-align:right;"> 23.86 </td>
   <td style="text-align:left;"> ▇▃▁▁▁ </td>
  </tr>
</tbody>
</table>

## Horsham Weather Data

> ## Challenge 1
>
> The Horsham weather data are formatted in the same way as the Curyo data.
> Find the correct URL and  download the data for Horsham and format to match
> the Curyo data using pipes to do it one step.
>
> > ## Solution to Challenge 1
> >
> >~~~
> >Horsham_w <-
> >   read_csv("https://zenodo.org/record/3842293/files/Horsham_SPA_2019_weather.csv?download=1") %>%
> >   select(Time,
> >          'Wind Speed - average (km/h)',
> >          'Wind Direction - average (º)',
> >          "Rainfall - (mm)") %>%
> >   mutate(Time = dmy_hm(Time)) %>%
> >   mutate(Location = "Horsham") %>%
> >   select(Location, everything())
> >~~~
> >{: .language-r}
> >
> >
> >
> >~~~
> >Parsed with column specification:
> >cols(
> >  Time = col_character(),
> >  `Air Temperature - average (ºC)` = col_double(),
> >  `Soil Temperature - average (ºC)` = col_double(),
> >  `Relative Humidity - average (%)` = col_double(),
> >  `Wind Speed - minimum (km/h)` = col_double(),
> >  `Wind Speed - average (km/h)` = col_double(),
> >  `Wind Speed - maximum (km/h)` = col_double(),
> >  `Wind Direction - average (º)` = col_double(),
> >  `Solar Radiation - average (W/m^2)` = col_double(),
> >  `Sigma - average (deg)` = col_double(),
> >  `Rainfall - (mm)` = col_double(),
> >  `Voltage - minimum (V)` = col_double(),
> >  `Voltage - average (V)` = col_double(),
> >  `Voltage - maximum (V)` = col_double(),
> >  `Apparent Temperature - average (ºC)` = col_double(),
> >  `Dew Point - average (ºC)` = col_double(),
> >  `Delta T - average (ºC)` = col_double()
> >)
> >~~~
> >{: .output}
> {: .solution}
>
> ## Challenge 2
> 
> Inspect the Horsham data to make sure that the structure is as you expect it to be.
> It should match the Curyo data.
>
> > ## Solution to Challenge 2
> >
> >~~~
> >skim(Horsham_w)
> >~~~
> >{: .language-r}
> >
> >
> ><table style='width: auto;'
> >        class='table table-condensed'>
> ><caption>Data summary</caption>
> > <thead>
> >  <tr>
> >   <th style="text-align:left;">   </th>
> >   <th style="text-align:left;">   </th>
> >  </tr>
> > </thead>
> ><tbody>
> >  <tr>
> >   <td style="text-align:left;"> Name </td>
> >   <td style="text-align:left;"> Horsham_w </td>
> >  </tr>
> >  <tr>
> >   <td style="text-align:left;"> Number of rows </td>
> >   <td style="text-align:left;"> 38705 </td>
> >  </tr>
> >  <tr>
> >   <td style="text-align:left;"> Number of columns </td>
> >   <td style="text-align:left;"> 5 </td>
> >  </tr>
> >  <tr>
> >   <td style="text-align:left;"> _______________________ </td>
> >   <td style="text-align:left;">  </td>
> >  </tr>
> >  <tr>
> >   <td style="text-align:left;"> Column type frequency: </td>
> >   <td style="text-align:left;">  </td>
> >  </tr>
> >  <tr>
> >   <td style="text-align:left;"> character </td>
> >   <td style="text-align:left;"> 1 </td>
> >  </tr>
> >  <tr>
> >   <td style="text-align:left;"> numeric </td>
> >   <td style="text-align:left;"> 3 </td>
> >  </tr>
> >  <tr>
> >   <td style="text-align:left;"> POSIXct </td>
> >   <td style="text-align:left;"> 1 </td>
> >  </tr>
> >  <tr>
> >   <td style="text-align:left;"> ________________________ </td>
> >   <td style="text-align:left;">  </td>
> >  </tr>
> >  <tr>
> >   <td style="text-align:left;"> Group variables </td>
> >   <td style="text-align:left;"> None </td>
> >  </tr>
> ></tbody>
> ></table>
> >
> >
> >**Variable type: character**
> >
> ><table>
> > <thead>
> >  <tr>
> >   <th style="text-align:left;"> skim_variable </th>
> >   <th style="text-align:right;"> n_missing </th>
> >   <th style="text-align:right;"> complete_rate </th>
> >   <th style="text-align:right;"> min </th>
> >   <th style="text-align:right;"> max </th>
> >   <th style="text-align:right;"> empty </th>
> >   <th style="text-align:right;"> n_unique </th>
> >   <th style="text-align:right;"> whitespace </th>
> >  </tr>
> > </thead>
> ><tbody>
> >  <tr>
> >   <td style="text-align:left;"> Location </td>
> >   <td style="text-align:right;"> 0 </td>
> >   <td style="text-align:right;"> 1 </td>
> >   <td style="text-align:right;"> 7 </td>
> >   <td style="text-align:right;"> 7 </td>
> >   <td style="text-align:right;"> 0 </td>
> >   <td style="text-align:right;"> 1 </td>
> >   <td style="text-align:right;"> 0 </td>
> >  </tr>
> ></tbody>
> ></table>
> >
> >
> >**Variable type: numeric**
> >
> ><table>
> > <thead>
> >  <tr>
> >   <th style="text-align:left;"> skim_variable </th>
> >   <th style="text-align:right;"> n_missing </th>
> >   <th style="text-align:right;"> complete_rate </th>
> >   <th style="text-align:right;"> mean </th>
> >   <th style="text-align:right;"> sd </th>
> >   <th style="text-align:right;"> p0 </th>
> >   <th style="text-align:right;"> p25 </th>
> >   <th style="text-align:right;"> p50 </th>
> >   <th style="text-align:right;"> p75 </th>
> >   <th style="text-align:right;"> p100 </th>
> >   <th style="text-align:left;"> hist </th>
> >  </tr>
> > </thead>
> ><tbody>
> >  <tr>
> >   <td style="text-align:left;"> Wind Speed - average (km/h) </td>
> >   <td style="text-align:right;"> 0 </td>
> >   <td style="text-align:right;"> 1 </td>
> >   <td style="text-align:right;"> 8.16 </td>
> >   <td style="text-align:right;"> 6.98 </td>
> >   <td style="text-align:right;"> 0 </td>
> >   <td style="text-align:right;"> 2.77 </td>
> >   <td style="text-align:right;"> 6.37 </td>
> >   <td style="text-align:right;"> 12.13 </td>
> >   <td style="text-align:right;"> 49.39 </td>
> >   <td style="text-align:left;"> ▇▃▁▁▁ </td>
> >  </tr>
> >  <tr>
> >   <td style="text-align:left;"> Wind Direction - average (º) </td>
> >   <td style="text-align:right;"> 0 </td>
> >   <td style="text-align:right;"> 1 </td>
> >   <td style="text-align:right;"> 164.14 </td>
> >   <td style="text-align:right;"> 133.97 </td>
> >   <td style="text-align:right;"> 0 </td>
> >   <td style="text-align:right;"> 15.19 </td>
> >   <td style="text-align:right;"> 160.41 </td>
> >   <td style="text-align:right;"> 292.59 </td>
> >   <td style="text-align:right;"> 359.89 </td>
> >   <td style="text-align:left;"> ▇▂▁▅▆ </td>
> >  </tr>
> >  <tr>
> >   <td style="text-align:left;"> Rainfall - (mm) </td>
> >   <td style="text-align:right;"> 0 </td>
> >   <td style="text-align:right;"> 1 </td>
> >   <td style="text-align:right;"> 0.01 </td>
> >   <td style="text-align:right;"> 0.07 </td>
> >   <td style="text-align:right;"> 0 </td>
> >   <td style="text-align:right;"> 0.00 </td>
> >   <td style="text-align:right;"> 0.00 </td>
> >   <td style="text-align:right;"> 0.00 </td>
> >   <td style="text-align:right;"> 6.80 </td>
> >   <td style="text-align:left;"> ▇▁▁▁▁ </td>
> >  </tr>
> ></tbody>
> ></table>
> >
> >
> >**Variable type: POSIXct**
> >
> ><table>
> > <thead>
> >  <tr>
> >   <th style="text-align:left;"> skim_variable </th>
> >   <th style="text-align:right;"> n_missing </th>
> >   <th style="text-align:right;"> complete_rate </th>
> >   <th style="text-align:left;"> min </th>
> >   <th style="text-align:left;"> max </th>
> >   <th style="text-align:left;"> median </th>
> >   <th style="text-align:right;"> n_unique </th>
> >  </tr>
> > </thead>
> ><tbody>
> >  <tr>
> >   <td style="text-align:left;"> Time </td>
> >   <td style="text-align:right;"> 0 </td>
> >   <td style="text-align:right;"> 1 </td>
> >   <td style="text-align:left;"> 2019-01-01 </td>
> >   <td style="text-align:left;"> 2019-12-06 14:30:00 </td>
> >   <td style="text-align:left;"> 2019-06-10 07:20:00 </td>
> >   <td style="text-align:right;"> 38705 </td>
> >  </tr>
> ></tbody>
> ></table>
> {: .solution}
{: .challenge}

## Merge and Filter the Data for Events

### Create the Event Data

Event data have dates and times when trap plants were deployed, retrieved and assessed for each event.
These data will be downloaded from the Zenodo archive as well.

1. Download using `read_csv()`.
2. Change "assessment date" to a date class.
3. Create a new column called "exposed" using the `interval()` function from `lubridate`.
4. Inspect the final data frame.


~~~
events <-
   read_csv("https://zenodo.org/record/3842293/files/Dispersal_experiment_dates.csv?download=1") %>%
   mutate(`assessment date` = dmy(`assessment date`)) %>%
   mutate(exposed = interval(`time out`, `time removed`))

kable(events, format = "html", table.attr = 'class="table table-hover"')
~~~
{: .language-r}

<table class="table table-hover">
 <thead>
  <tr>
   <th style="text-align:left;"> site </th>
   <th style="text-align:right;"> rep </th>
   <th style="text-align:left;"> time out </th>
   <th style="text-align:left;"> time removed </th>
   <th style="text-align:left;"> assessment date </th>
   <th style="text-align:right;"> exposed </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Horsham irrigated </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 2019-10-09 18:00:00 </td>
   <td style="text-align:left;"> 2019-10-10 18:00:00 </td>
   <td style="text-align:left;"> 2019-10-24 </td>
   <td style="text-align:right;"> 2019-10-09 18:00:00 UTC--2019-10-10 18:00:00 UTC </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Horsham irrigated </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> 2019-10-14 18:00:00 </td>
   <td style="text-align:left;"> 2019-10-15 18:00:00 </td>
   <td style="text-align:left;"> 2019-10-31 </td>
   <td style="text-align:right;"> 2019-10-14 18:00:00 UTC--2019-10-15 18:00:00 UTC </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Horsham irrigated </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:left;"> 2019-11-06 18:00:00 </td>
   <td style="text-align:left;"> 2019-11-07 18:00:00 </td>
   <td style="text-align:left;"> 2019-11-21 </td>
   <td style="text-align:right;"> 2019-11-06 18:00:00 UTC--2019-11-07 18:00:00 UTC </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Horsham dryland </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 2019-10-15 08:00:00 </td>
   <td style="text-align:left;"> 2019-10-17 18:00:00 </td>
   <td style="text-align:left;"> 2019-10-31 </td>
   <td style="text-align:right;"> 2019-10-15 08:00:00 UTC--2019-10-17 18:00:00 UTC </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Horsham dryland </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> 2019-11-01 08:00:00 </td>
   <td style="text-align:left;"> 2019-11-08 18:00:00 </td>
   <td style="text-align:left;"> 2019-11-22 </td>
   <td style="text-align:right;"> 2019-11-01 08:00:00 UTC--2019-11-08 18:00:00 UTC </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Curyo </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 2019-10-15 08:00:00 </td>
   <td style="text-align:left;"> 2019-10-17 18:00:00 </td>
   <td style="text-align:left;"> 2019-10-31 </td>
   <td style="text-align:right;"> 2019-10-15 08:00:00 UTC--2019-10-17 18:00:00 UTC </td>
  </tr>
</tbody>
</table>

### Filter and Merge the Locations' Data

Filter the data removing any dates that do not have "event" data necessary for analysis.
Because events overlap at Horsham, the dryland and irrigated sites are handled separately first, then combined.
To do this, first `filter()`, then use `case_when()` to match the dates and times with the `events` data frame and create new variables to indicate which replicate and location, which is used to determine an event in the data.

Here we use a special function, `%within%` from `lubridate` to check, "Does a date (or interval) fall within an interval?"

Using `%within%` we will filter the weather data, keeping only the times and dates when the trap plants were exposed for each event and location.

#### Horsham Irrigated


~~~
Horsham_irrg <-
   Horsham_w %>%
   filter(Time %within% events[1, "exposed"] |
             Time %within% events[2, "exposed"] |
             Time %within% events[3, "exposed"]) %>%
   mutate(
      Location = case_when(
         Time %within% events[1, "exposed"] ~ events[[1, "site"]],
         Time %within% events[2, "exposed"] ~ events[[2, "site"]],
         Time %within% events[3, "exposed"] ~ events[[3, "site"]]
      )
   ) %>%
   mutate(
      Rep = case_when(
         Time %within% events[1, "exposed"] ~ events[[1, "rep"]],
         Time %within% events[2, "exposed"] ~ events[[2, "rep"]],
         Time %within% events[3, "exposed"] ~ events[[3, "rep"]]
      )
   ) %>%
   rename(site = Location, rep = Rep, time = Time) %>%
   select(site, rep, time, everything())
~~~
{: .language-r}

#### Horsham Rain


~~~
Horsham_rain <-
   Horsham_w %>%
   filter(Time %within% events[4, "exposed"] |
             Time %within% events[5, "exposed"]) %>%
   mutate(Location = case_when(Time %within% events[4, "exposed"] ~ events[[4, "site"]],
                               Time %within% events[5, "exposed"] ~ events[[5, "site"]])) %>%
   mutate(Rep = case_when(Time %within% events[4, "exposed"] ~ events[[4, "rep"]],
                          Time %within% events[5, "exposed"] ~ events[[5, "rep"]],)) %>%
   rename(site = Location, rep = Rep, time = Time) %>%
   select(site, rep, time, everything())
~~~
{: .language-r}

#### Curyo Rain


~~~
Curyo_rain <-
   Curyo_w %>%
   filter(Time %within% events[which(events$site == "Curyo"), "exposed"]) %>%
   mutate(Location = case_when(Time %within% events[which(events$site == "Curyo"),
                                                    "exposed"] ~ "Curyo")) %>%
   mutate(Rep = case_when(Time %within% events[which(events$site == "Curyo"), "exposed"] ~
                             events[[which(events$site == "Curyo"), "rep"]])) %>%
   rename(site = Location, rep = Rep, time = Time) %>%
   select(site, rep, time, everything())
~~~
{: .language-r}



~~~
Error: Problem with `filter()` input `..1`.
x No %within% method with signature a = character,  b = tbl_df
ℹ Input `..1` is `Time %within% events[which(events$site == "Curyo"), "exposed"]`.
~~~
{: .error}



~~~
weather <- bind_rows(Curyo_rain, Horsham_irrg, Horsham_rain)
~~~
{: .language-r}



~~~
Error in list2(...): object 'Curyo_rain' not found
~~~
{: .error}

### Rename Columns and Add Other Calculations

The `Wind Speed - average (km/h)` column is converted to metres per second and renamed `wind_speed`.
The standard deviation of the wind speed and wind direction are calculated for the data.
The columns are then reordered by `Location`, `Rep`, `Time` and the weather data.


~~~
cleaned_weather <-
   weather %>%
   mutate(`Wind Speed - average (km/h)` = `Wind Speed - average (km/h)` /
             3.6) %>%
   rename(wind_speed = `Wind Speed - average (km/h)`) %>%
   rename(wind_direction = `Wind Direction - average (º)`) %>%
   rename(rainfall = `Rainfall - (mm)`) %>%
   select(site, rep, time, everything()) %>%
   arrange(site, rep, time) %>% 
   mutate_at(vars(site, rep), factor)
~~~
{: .language-r}



~~~
Error in eval(lhs, parent, parent): object 'weather' not found
~~~
{: .error}



~~~
glimpse(cleaned_weather)
~~~
{: .language-r}



~~~
Rows: 2,202
Columns: 6
$ site           <fct> Curyo, Curyo, Curyo, Curyo, Curyo, Curyo, Curyo, Curyo…
$ rep            <fct> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ time           <dttm> 2019-10-15 08:00:00, 2019-10-15 08:10:00, 2019-10-15 …
$ wind_speed     <dbl> 3.37, 3.44, 3.30, 3.49, 3.69, 3.73, 3.61, 3.32, 3.40, …
$ wind_direction <dbl> 350.537678, 357.810346, 357.167889, 357.911110, 355.97…
$ rainfall       <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
~~~
{: .output}

### Summarise Weather Data by Event

The weather data are now ready for summarising for each event that occurred.
The resulting columns are:

* mws - mean wind speed in meters per second

* ws_sd - standard deviation of the wind speed

* mwd - mean wind direction in degrees

* wd_sd - standard deviation of the wind direction in degrees

* sum_rain - total rainfall and irrigation (if applicable) during the event


~~~
summary_weather <-
   cleaned_weather %>%
   group_by(site, rep) %>%
   summarise(
      mws = mean(wind_speed),
      ws_sd = sd(wind_speed),
      max_ws = max(wind_speed),
      min_ws = min(wind_speed),
      mwd = circular.averaging(wind_direction),
      sum_rain = sum(rainfall)
   ) %>%
   mutate(# add the 11 mm of irrigation to the summary
      sum_rain =
         case_when(site == "Horsham irrigated" ~ sum_rain + 11,
                   TRUE ~ sum_rain))
~~~
{: .language-r}



~~~
`summarise()` regrouping output by 'site' (override with `.groups` argument)
~~~
{: .output}



~~~
kable(summary_weather,
      align = "c",
      caption = "Summary weather data for replicated rain event (spread event) per unique site.")
~~~
{: .language-r}

<table>
<caption>Summary weather data for replicated rain event (spread event) per unique site.</caption>
 <thead>
  <tr>
   <th style="text-align:center;"> site </th>
   <th style="text-align:center;"> rep </th>
   <th style="text-align:center;"> mws </th>
   <th style="text-align:center;"> ws_sd </th>
   <th style="text-align:center;"> max_ws </th>
   <th style="text-align:center;"> min_ws </th>
   <th style="text-align:center;"> mwd </th>
   <th style="text-align:center;"> sum_rain </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> Curyo </td>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> 3.577163 </td>
   <td style="text-align:center;"> 2.2302100 </td>
   <td style="text-align:center;"> 9.41 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:center;"> 353.5045 </td>
   <td style="text-align:center;"> 0.8 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Horsham dryland </td>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> 3.085387 </td>
   <td style="text-align:center;"> 1.9379332 </td>
   <td style="text-align:center;"> 7.61 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:center;"> 311.0201 </td>
   <td style="text-align:center;"> 4.6 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Horsham dryland </td>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> 3.996127 </td>
   <td style="text-align:center;"> 2.7133595 </td>
   <td style="text-align:center;"> 11.24 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:center;"> 332.3283 </td>
   <td style="text-align:center;"> 18.6 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Horsham irrigated </td>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> 1.902828 </td>
   <td style="text-align:center;"> 0.9050266 </td>
   <td style="text-align:center;"> 4.01 </td>
   <td style="text-align:center;"> 0.35 </td>
   <td style="text-align:center;"> 234.6542 </td>
   <td style="text-align:center;"> 11.0 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Horsham irrigated </td>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> 2.233103 </td>
   <td style="text-align:center;"> 1.2895001 </td>
   <td style="text-align:center;"> 4.16 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:center;"> 272.7072 </td>
   <td style="text-align:center;"> 11.0 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Horsham irrigated </td>
   <td style="text-align:center;"> 3 </td>
   <td style="text-align:center;"> 6.531586 </td>
   <td style="text-align:center;"> 2.1241262 </td>
   <td style="text-align:center;"> 11.24 </td>
   <td style="text-align:center;"> 2.75 </td>
   <td style="text-align:center;"> 333.6699 </td>
   <td style="text-align:center;"> 11.6 </td>
  </tr>
</tbody>
</table>
